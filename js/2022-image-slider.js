// FOR 2022 EVENTS !!!!
// SET IMAGES FOR SLIDER HERE
const sliderImages = [
   
    
    {
        artworURLString: "algozine", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/zine_thumb.png",
            alt: "A hand written zine with illustration drawn in felt-tip pen",
        }],
  },
    
    {
        artworURLString: "look-up", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/look_thumb.png",
            alt: "Colourful digital blocks in a grid",
        }],
  },
    
    
    {
        artworURLString: "st-annes-house-live-broadcast", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/st-annes_thumb.png",
            alt: "Two people stand in front of St Annes House, a large office style building",
        }],
  },
    
    {
        artworURLString: "from-cyber-punk-to-time-hunting", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/podcast_thumb.png",
            alt: "A brightly coloured illustration of the artists",
            credit: "Container / Lucy J Turner",
        }],
  },
    
    {
        artworURLString: "no-light-work", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/nolight_thumb.png",
            alt: "Absract lines and shapes arranged on a red and black background",
            credit: "David Matunda",
        }],
  },
    {
        artworURLString: "giant-tactile-robots", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/airgiants_thumb.png",
            alt: "Two children hug an illuminated inflatable robot in a park",
            credit: "Air Giants"
        }],
  },
  {
    artworURLString: "marbling-with-machine-bodies", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
    images: [{
        url: "../img/2022/marbling.png",
        alt: "Drawing tools as an assistive aids - spinning plate with marbling paint on it.",
        credit: "Joseph Wilk"
    }],
},

    {
        artworURLString: "algorave", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/algorave_thumb.png",
            alt: "A man with a wooly hat on DJ-ing, with pink and polka dots projected image over him and the wall",
            credit: "Richard Hodgkinson"
        }],
  },
    
     {
        artworURLString: "lunchtime-talk", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/lunchtimetalk_thumb.png",
            alt: "A grid of people on a zoom screen showing art"
        }],
  },


    {
        artworURLString: "dzata-the-institute-of-technological-consciousness", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/dzata1_thumb.png",
            alt: "Three futuristic people hike across a rock face seen from distance, and above, the golden rocks look like a close up of wrinkled skin ",
            credit: "Drone Still by Haroon Gunn-Salie. Courtesy of Russel Hlongwane, Francois Knoetze, Amy Louise Wilson",
        }],
  },
    
     {
        artworURLString: "live-coding-for-performance", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/livecoding_thumb.png",
            alt: "A man DJ-ing in front of bright green, blue, purple, pink glitched projected image over him and the wall.",
            credit: "Marcin Sz",
        }],
  },
    
        {
        artworURLString: "live-scored-performance-of-dzata", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/dzata3_thumb.png",
            alt: "A messy futuristic scene with a man in front of a big yellow lit table",
            credit: "Russel Hlongwane, Francois Knoetze, Amy Louise Wilson",
        }],
  },
    
            {
        artworURLString: "choreographing-web-environments", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/choreo_thumb.png",
            alt: "A woman kneels on a stage in front of a laptop and microphone holding a manuscript, in front is a large projection of a website.",
            credit: "Ana Caria and Leonor Fonseca",
        }],
  },
    
        {
        artworURLString: "keeping-in-touch", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/keeping_thumb.png",
            alt: "An animated gif of a woman staring, deep in thought out of the window, they sit on an armchair with a bold print. The image glitches in yellow, green, pink, red and blue",
            credit: "Giulia Carla Rossi",
        }],
  },

    {
        artworURLString: "periodical", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/perodical_thumb.png",
            alt: "A linocut print of a body with faceless features on thick paper",
            credit: "Wisterlitz",
            
        }],
  },
    
    {
        artworURLString: "divination-is-an-intimate-affair", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/digitalwitch_thumb.png",
            alt: "The text -the working class is a daughter- is written above a digital render of a sheet, and blue triangle graphics",
            credit: "DANNEA",
        }],
  },
    
    {
        artworURLString: "drawing-sound-networks", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/prrrrrt_thumb.png",
            alt: "Close up of someone holding a printed circuit board, wires come of of the top of the board, and the board has a spotty and stripy design",
            credit: "PRRRRRT!",
        }],
  },
    
        {
        artworURLString: "the-phone-project", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/phone_thumb.png",
            alt: "Two hands, one holds a phone and the other, painted with red nail polish ,zooms in with two fingers. The phone is off",
        }],
  },
    
        {
        artworURLString: "rare-earth-walks", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/rareearth_thumb.png",
            alt: "A fragment of a rock, wrapped in a copper bow ",
            credit: "Max Dovey",
        }],
  },
    {
        artworURLString: "ai-tattoo", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "https://lh3.googleusercontent.com/eiUrYtl8mf5sscDBhtCMugAr-adAfmmuLJaKIdd5CnQT3z3OTdWp6m_mf29NFf6uV6AE8N_7o73fqbHcUKjzMOoCNL4NBu8_gUQGuSGtCMtwIzcScJIxgsqbmHYstthFDQ0AKIp6TQ=w2400",
            alt: "A white, femme appearing person looks through the lens of a camera at their intricate tattoo on their arm. The black and white tattoo is of a winding snake with dancing creatures attached.",
            credit: "Alice Stewart",
        }],
  },
    {
        artworURLString: "poem-garden", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [
            {
                url: "../img/2022/poem_site/1.jpg",
                alt: "A collage of a pink flower with long stamen and green leaf with text inside three bubbles - the garden - the nasturtiums - the rose bush",
                credit: "Harriet Horobin-Worley"
            },
            {
                url: "../img/2022/poem_site/2.png",
                alt: "A brightly coloured collage of orange flowers, green leaves and a telegraph pole",
                credit: "Harriet Horobin-Worley"
            },
            {
                url: "../img/2022/poem_site/3.jpg",
                alt: "Text in a box - the scraggaly wild rose bush grew fast and raggid throughout the year, though we seem to always be cutting it back",
                credit: "Harriet Horobin-Worley"
            },
            {
                url: "../img/2022/poem_site/4.png",
                alt: "multi-coloured wires in a server room looking like woven fabric arranged on a frame",
                credit: "Harriet Horobin-Worley"
            },
            {
                url: "../img/2022/poem_site/5.jpg",
                alt: "A cut out of a yellow flower, the image is textured, and there are drops of water on the petals",
                credit: "Harriet Horobin-Worley"
        }],
  },
    {
        artworURLString: "set-scripted-emergent-togetherness", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/SET_install_thumb.png",
            alt: "A collage features the names of some feelings in handwritten form on a grid drawn in wobbly lines: calm, interested, annoyed, slow, excited, released, sad, tired, happy, anxious, rested, joyful, grateful, relaxed, sleepy, understood, questioning, amused, amazed, exhausted, clarity, full. Cut-out scans of stim bracelets surround some of the words, and some of the lines consist of rearranged stim bracelet pieces.",
        }],
  },
    {
        artworURLString: "can-a-website-be-a-garden", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [
            {
                url: "../img/2022/poem_workshop/1.jpg",
                alt: "Three gloves on a flagstone pavement, made into a digital collage with orange, yellow and green. The text says - why are lost gloves so strangely expressive? Once you start looking for them you see them everywhere-"

            },
            {
                url: "../img/2022/poem_workshop/2.jpg",
                alt: "A workshop, someone sits, and someone stands pointing to a projection on the wall"
            },
            {
                url: "../img/2022/poem_workshop/3.jpg",
                alt: "A pink website with a retro apple computer and nokia phone"
            },
            {
                url: "../img/2022/poem_workshop/4.jpg",
                alt: "A website with an image of a jaffa cake chopped in half and digestive biscuit, website code is on left of screen"
            }, {
                url: "../img/2022/poem_workshop/5.jpg",
                alt: "another image of laptop screen with digestive biscuit on a blue background with text - dunk me but not for too long. Text under the jaffa cake reads - don't even think about it. Text under ginger biscuit - the original dunker, dunk me forever xxx"
            }, {
                url: "../img/2022/poem_workshop/6.jpg",
                alt: "A laptop screen with a zig zag pattern and a curled up insect"
            },
            {
                url: "../img/2022/poem_workshop/7.jpg",
                alt: "In a workshop people are looking at images on screens"
        }],
  },
    {
        artworURLString: "show-and-share", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/QTB_thumb.png",
            alt: "A woman with long hair sits at a computer, the image is textured and looks retro. Written are the words -queer tech bristol, Tuesday 15th November, 6-8pm, PM Studio, Watershed-"
        }],
  },
    {
        artworURLString: "ready-s-e-t", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [

            {
                url: "../img/2022/SET_workshop/1.png",
                alt: "In a blue lit space a woman lies on a textured mat, speaking to someone in their phone, their face is lit by the light of the phone."
            },
            {
                url: "../img/2022/SET_workshop/2.png",
                alt: "A grid of people on a zoom workshop, in one of the squares there are people around a table"
            },
            {
                url: "../img/2022/SET_workshop/3.png",
                alt: "A collection of deep green and red maple leaf, an acorn, a sicamore seed, an honesty seed"
            },
            {
                url: "../img/2022/SET_workshop/4.png",
                alt: "people sit around a table focusing on something they are reading whilst text is projected on a screen in a blue lit room"
            },
            {
                url: "../img/2022/SET_workshop/5.png",
                alt: "Someone on a call, looking at a tablet wearing headphones"
        }],
  },
    {
        artworURLString: "introducing-feeling-machines", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [{
            url: "../img/2022/introducing_thumb.png",
            alt: ""
        }],
  },
    {
        artworURLString: "the-almost", //must match url param, ex - https://www.control-shift.network/artwork.html?artwork=poem-garden would be "poem-garden" 
        images: [
            {
                url: "../img/2022/The_Almost/0.jpg",
                alt: "A painting of a figure emerging out of the backdrop of a phone, being held. Painted in a textural way, with neon yellows, reds, and blues."
            },
            {
                url: "../img/2022/The_Almost/1.jpg",
                alt: "Close up of a painted hand"
            },
            {
                url: "../img/2022/The_Almost/2.jpeg",
                alt: "A close up of painting of a figure emerging out of the backdrop of a phone, being held. Painted in a textural way, with neon yellows, reds, and blues"
            },
            {
                url: "../img/2022/The_Almost/4.jpg",
                alt: "A close up of painting of an arm in neon colours"
            },
            {
                url: "../img/2022/The_Almost/5.jpeg",
                alt: "A close up of painting of two figures"
            },
            {
                url: "../img/2022/The_Almost/6.jpg",
                alt: "Close up of a painted fragment"
            }
    ],
  },
];

const queryString = window.location.search;
const artistURLParam = queryString.match(/[^=]*$/g)[0];
let result = sliderImages.find(({
    artworURLString
}) => artworURLString === artistURLParam);
// If there is no match then fall back on the Feeling weeekends thumbnail imaage
if (!result) { 
  result = sliderImages.find(({ artworURLString}) => artworURLString === "feeling-machines-st-annes-house");
}




const imageLoaded = result.images.map(function (image, i) {
    let sliderContainer = document.getElementById("slider-container");
    let imageOuterDiv = document.createElement("div");
    imageOuterDiv.setAttribute("class", "project project" + i);
    result.images.length === 1 ?
        gsap.set(".button-container, .gallery-list__progress-bar, .gallery-list__progress-track", {
            display: "none",
        }) :
        "";

    let imageInnerDiv = document.createElement("div");
    if (i === 0) {
        imageInnerDiv.setAttribute("class", "project-image project-image01");
    } else {
        imageInnerDiv.setAttribute("class", "project-image");
    }

    let credit = document.createElement("p");
    credit.className = "image-credit pt-2";
    credit.innerHTML = image.credit ? `Image credit: ${image.credit}` : "";
    sliderElem = document.createElement("img");
    sliderElem.setAttribute("class", "sliderImage");
    sliderElem.setAttribute("src", image.url);
    sliderElem.setAttribute("alt", image.alt);
    // add slider element
    imageInnerDiv.appendChild(sliderElem);
    imageInnerDiv.appendChild(credit)

    imageOuterDiv.appendChild(imageInnerDiv);
    sliderContainer.appendChild(imageOuterDiv);
});

window.onresize = changeButtonPosition; //because the image container is set as absolute, we need a way of telling if the image is smaller on some screens to prevent a gap between the projects div and the navigation buttons

// changes button position to under project image
function changeButtonPosition() {
    projectContainerHeight = document.querySelector(".project-image")
        .clientHeight;
    document.querySelector(".projects").style.height =
        projectContainerHeight + 15 + "px";
}

// creating the width of the progress bar by the client width of whole bar divded by no of divs in slider
function createProgessBar() {
    progressBarWidth = document.querySelector(".gallery-list__progress-track")
        .clientWidth;
    indicatorWidth =
        progressBarWidth / document.querySelectorAll(".project").length;
    gsap.set(".gallery-list__progress-bar", {
        width: indicatorWidth
    });
}

// called on return of promises - when the images are loaded into the slider
function init() {
    // check whether slider is needed
    createProgessBar();
    changeButtonPosition();

    gsap.set(".project", {
        x: "-100%"
    }); // images start off screen
    gsap.set(".project", {
        autoAlpha: 1
    }); // images all set to full opacity

    let currentStep = 0; //first image
    const totalSlides = document.querySelectorAll(".project").length; //total divs in slider

    const wrapper = gsap.utils.wrap(0, totalSlides); // slider will wrap back to 0 when total slides is reached

    createfirstTimeline(currentStep); //calls first slide in

    function createfirstTimeline(index) {
        leftImage = index - 1 < 0 ? totalSlides - 1 : index - 1; // if user presses back it will show last image
        // Handles only one slide
        if (totalSlides === 1) {
            const image = document.querySelector("div.project0");
            gsap.timeline().fromTo(
                image, {
                    x: "0%", //starting position - entering from righthand side
                }, {
                    duration: 1.3,
                    x: 0, //ending position - moving into the center
                    zIndex: 10,
                }
            );
        } else {
            // If multiple divs in slider
            const imageInnerRight = document.querySelector("div.project" + index);
            const imageFurthestRight = document.querySelector(
                "div.project" + (index + 1)
            );
            const imageInnerLeft = document.querySelector("div.project" + leftImage);
            const timelineIn = gsap.timeline({
                id: "timelineIn"
            }); //creating gsap timeline
            timelineIn.fromTo(
                    imageInnerRight, {
                        x: "0%", //starting position - entering from righthand side
                    }, {
                        duration: 0,
                        x: 0, //ending position - moving into the center
                        zIndex: 10,
                    }
                ),
                timelineIn.fromTo(
                    imageInnerLeft, {
                        x: "-700", //starting position - entering from the lefthand side
                    }, {
                        duration: 1.0,
                        x: -700, //ending position - moving into the far left position (partially off lefthand side)
                    },
                    0.7 // this sets a 0.7 second delay in tween starting
                ),
                timelineIn.fromTo(
                    imageFurthestRight, {
                        // autoAlpha: 0, //autoAlpha animates opacity - in this case from 0 to 1
                        x: "700", //starting position (set above)
                    }, {
                        duration: 1.0,
                        x: 700, //ending position - moving into the far right position (partially off right side)
                    },
                    0.7 // this sets a 0.7 second delay in tween starting
                );
            return timelineIn;
        }
    }

    // createTimelineIn is called when button next or prev is clicked
    function createTimelineIn(direction, index, current) {
        const goPrev = direction === "prev";
        let imageFurthestLeft,
            imageInnerLeft,
            imageFurthestRight,
            imageInnerRight,
            position;

        // animating progress bar
        progressBar = document.querySelector(".gallery-list__progress-bar"); //to target in order to change position of progressbar indicator
        const progressIndicatorWidth = progressBar.clientWidth; //width of progressbar indicator set earlier
        progressBarWidth = document.querySelector(".gallery-list__progress-track")
            .clientWidth; //working out width of whole progress bar (based on 100% width of page)

        if (current === 0 && direction === "prev") {
            position = progressBarWidth - progressIndicatorWidth;
        } else if (current === totalSlides - 1 && direction === "next") {
            position = 0;
        } else if (direction === "prev") {
            position =
                `-=` + (progressBarWidth - progressIndicatorWidth) / (totalSlides - 1);
        } else {
            position =
                `+=` + (progressBarWidth - progressIndicatorWidth) / (totalSlides - 1);
        }
        if (!goPrev) {
            //working out which images to target in order to change their position in the timeline below
            toExit = current - 1 < 0 ? totalSlides - 1 : current - 1;
            toEnter = index + 1 > totalSlides - 1 ? 0 : index + 1;
            imageFurthestLeft = document.querySelector("div.project" + toExit);
            imageInnerRight = document.querySelector("div.project" + index);
            imageFurthestRight = document.querySelector("div.project" + toEnter);
            imageInnerLeft = document.querySelector("div.project" + current);
        } else {
            //working out which images to target in order to change their position in the timeline below
            toEnter = index - 1 < 0 ? totalSlides - 1 : index - 1;
            toExit = current + 1 > totalSlides - 1 ? 0 : current + 1;
            imageFurthestLeft = document.querySelector("div.project" + toEnter);
            imageFurthestRight = document.querySelector("div.project" + toExit);
            imageInnerRight = document.querySelector("div.project" + current);
            imageInnerLeft = document.querySelector("div.project" + index);
        }
        const timelineIn = gsap.timeline({
            id: "timelineIn"
        });
        timelineIn.fromTo(
                imageFurthestRight, {
                    x: 1400,
                }, {
                    runBackwards: goPrev ? true : false, //if user pressed back (goPrev is true) then runBackwards will reverse the start and end x position
                    duration: 0.7,
                    x: 700,
                }
            ),
            timelineIn.fromTo(
                imageInnerRight, {
                    x: 700,
                }, {
                    runBackwards: goPrev ? true : false,
                    duration: 0.7,
                    x: 0,
                    zIndex: 10,
                },
                0
            ),
            timelineIn.fromTo(
                imageInnerLeft, {
                    x: 0,
                }, {
                    runBackwards: goPrev ? true : false,
                    duration: 0.7,
                    x: -700,
                },
                0
            ),
            timelineIn.fromTo(
                imageFurthestLeft, {
                    x: -700,
                }, {
                    runBackwards: goPrev ? true : false,
                    duration: 0.7,
                    x: -1400,
                },
                0
            ),
            timelineIn.to(
                progressBar, {
                    duration: 0.7,
                    x: position,
                },
                0
            );
        return timelineIn;
    }

    function updateCurrentStep(goToIndex) {
        currentStep = goToIndex;
    }

    function transition(direction, toIndex) {
        const timelineTransition = gsap.timeline({
            onStart: function () {
                console.log({
                    fromIndex: currentStep
                }, {
                    toIndex
                });
                updateCurrentStep(toIndex);
            },
        });
        const tlIn = createTimelineIn(direction, toIndex, currentStep);
        timelineTransition.add(tlIn); //calls function above createTimelineIn
        return timelineTransition;
    }

    function isTweening() {
        return gsap.isTweening(".project"); //prevents user being able to click twice on arrows and flick through many images before the transition is finished
    }

    document.querySelector("button.next").addEventListener("click", function (e) {
        e.preventDefault();
        const nextStep = wrapper(currentStep + 1);
        !isTweening() && transition("next", nextStep);
    });

    document.querySelector("button.prev").addEventListener("click", function (e) {
        e.preventDefault();
        const prevStep = wrapper(currentStep - 1);
        !isTweening() && transition("prev", prevStep);
    });

    // touch events
    let ts;
    $(".project img").on({
        touchstart: function (e) {
            ts = e.originalEvent.touches[0].clientX;
        },
    });

    $(".project img").on({
        touchmove: function (e) {
            var te = e.originalEvent.changedTouches[0].clientX;
            if (ts > te && totalSlides > 3) {
                const nextStep = wrapper(currentStep + 1);
                !isTweening() && transition("next", nextStep);
            } else {
                const prevStep = wrapper(currentStep - 1);
                !isTweening() && transition("prev", prevStep);
            }
        },
    });
}
